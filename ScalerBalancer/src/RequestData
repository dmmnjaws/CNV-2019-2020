import com.amazonaws.services.dynamodbv2.model.AttributeValue;
import com.sun.net.httpserver.HttpExchange;
import pt.ulisboa.tecnico.cnv.server.AmazonDynamoDBAid;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;

public class RequestData{

    private String requestId;
    private double predictedLoad;

    public RequestData(String requestId){
        this.requestId = requestId;
        this.predictedLoad = 0;
        calculatePredictedLoad();
    }

    public void calculatePredictedLoad(){

        try {
            AmazonDynamoDBAid.init();
        } catch (Exception e) {
            e.printStackTrace();
        }

        List<Map<String, AttributeValue>> metrics = AmazonDynamoDBAid.getItem(requestId);

        if(!metrics.isEmpty()){
            Map<String, AttributeValue> metric = metrics.get(0);
            this.predictedLoad = (double) 0.5 * (double) Double.valueOf(metric.get("instructions").getN()) + 0.5 * (double) Double.valueOf(metric.get("basicBlocks").getN());
        }
    }
}